"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkGuildBans=exports.deleteMessage=void 0;const database_1=__importDefault(require("../database")),bulks=new Map,rates=new Map,deleteMessage=e=>{if(!e.channel)return;const t=rates.get(e.channel.id)||0;rates.set(e.channel.id,t+1),setTimeout((()=>rates.set(e.channel.id,(rates.get(e.channel.id)||0)-1)),1e4);const a=bulks.get(e.channel.id)||[];a.length?a.push(e):t<3?e.delete().catch((()=>null)):(bulks.set(e.channel.id,[e]),setTimeout((()=>{e.channel&&(e.channel.bulkDelete(bulks.get(e.channel.id)).catch((()=>null)),bulks.delete(e.channel.id))}),5e3))};exports.deleteMessage=deleteMessage;const checkGuildBans=async e=>{if(!e.available)return;const t=await database_1.default.guild(e.id);let{bans:a}=t.get(),s=Object.keys(a).filter((e=>-1!==a[e]&&a[e]<=Date.now()));s.length&&await Promise.all(s.map((async a=>{e.me.permissions.has("BAN_MEMBERS")&&await e.bans.remove(a).then((()=>t.removeFromObject("bans",a))).catch((()=>t.removeFromObject("bans",a)))})))};exports.checkGuildBans=checkGuildBans;