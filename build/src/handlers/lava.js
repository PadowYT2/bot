"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const erela_js_1=require("erela.js"),erela_js_spotify_1=__importDefault(require("erela.js-spotify")),string_progressbar_1=require("string-progressbar"),config_1=__importDefault(require("../../config")),{lava:{nodes:nodes,spotify:{clientID:clientID,clientSecret:clientSecret}}}=config_1.default,bot_1=require("../bot"),pretty_ms_1=__importDefault(require("pretty-ms"));module.exports=e=>new erela_js_1.Manager({nodes:nodes,plugins:[new erela_js_spotify_1.default({clientID:clientID,clientSecret:clientSecret})],defaultSearchPlatform:"youtube",send(t,n){e.guilds.cache.get(t)?.shard.send(n)}}).on("trackError",(async(t,{title:n},a)=>{const o=e.channels.cache.get(t.textChannel);try{await o.send(`An error occured when trying to play \`${n}\`: ${a.exception?.cause||a.error}`)}catch{}})).on("trackStuck",(async(t,{title:n},a)=>{const o=e.channels.cache.get(t.textChannel);try{await(o?.send(`\`${n}\` got stuck.`))}catch{}})).on("nodeConnect",(({options:e})=>console.log(`${bot_1.shard} Lava ${e.host}:${e.port} connected.`))).on("nodeError",(({options:e},t)=>console.log(`${bot_1.shard} Lava ${e.host}:${e.port} had an error: ${t.message}`))).on("trackStart",(async(t,n)=>{const a=e.channels.cache.get(t.voiceChannel),o=e.channels.cache.get(t.textChannel);if(a?.members.filter((t=>t.user.id!==e.user.id)).size)try{let e=t.get("message");e||(e=await o.send("‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...")),t.set("message",e);const a=1e3*Math.floor(n.duration/1e3),r=1e3*Math.floor(t.position/1e3),s=[(0,string_progressbar_1.splitBar)(a,r,20)[0]," [",(0,pretty_ms_1.default)(r,{colonNotation:!0,compact:!0})," / ",(0,pretty_ms_1.default)(a,{colonNotation:!0,compact:!0}),"]"].join("");await e.edit({content:`üé∂ –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç: ${n.title}`,embeds:[{title:n.title,url:n.uri,thumbnail:{url:n.thumbnail},fields:[{name:"–ê–≤—Ç–æ—Ä",value:n.author,inline:!0},{name:"–ü—Ä–æ–≥—Ä–µ—Å—Å",value:s}]}]});const i=setInterval((async()=>{const a=1e3*Math.floor(n.duration/1e3),o=1e3*Math.floor(t.position/1e3),r=[(0,string_progressbar_1.splitBar)(a,o,20)[0]," [",(0,pretty_ms_1.default)(o,{colonNotation:!0,compact:!0})," / ",(0,pretty_ms_1.default)(a,{colonNotation:!0,compact:!0}),"]"].join("");await e.edit({content:`üé∂ –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç: ${n.title}`,embeds:[{title:n.title,url:n.uri,thumbnail:{url:n.thumbnail},fields:[{name:"–ê–≤—Ç–æ—Ä",value:n.author,inline:!0},{name:"–ü—Ä–æ–≥—Ä–µ—Å—Å",value:r}]}]})}),5e3);setTimeout((()=>clearInterval(i)),n.duration)}catch{}else{t.destroy();try{await o.send("–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–∫–∏–Ω—É–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–∞–Ω–∞–ª. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–µ–µ—Ä.")}catch{}}})).on("queueEnd",(async t=>{const n=e.channels.cache.get(t.textChannel);try{let e=t.get("message");e||await n.send({content:"–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–µ–µ—Ä.",embeds:[]}),await e.edit({content:"–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–µ–µ—Ä.",embeds:[]})}catch{}t.destroy()})).init(e.user.id);