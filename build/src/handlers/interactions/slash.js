"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerCommands=exports.commands=void 0;const constants_1=require("../../constants/"),database_1=__importDefault(require("../../database/"));exports.default=async e=>{if((await database_1.default.guild(e.guild.id)).get().channel===e.channel.id)return await e.reply({content:"❌ Команды недоступны в этом канале",ephemeral:!0});const r=e.commandName,s=require(`../../commands/${r}`);if((0,constants_1.getPermissionLevel)(e.member)<s.permission)return await e.reply({content:"❌ Недостаточно прав.",ephemeral:!0});try{s.run(e)}catch(e){console.error(`Error in ${r}:`,e)}};const rest_1=require("@discordjs/rest"),v9_1=require("discord-api-types/v9"),fs_1=__importDefault(require("fs")),config_1=__importDefault(require("../../../config"));exports.commands=[];const registeredGuilds=[],rest=new rest_1.REST({version:"9"}).setToken(config_1.default.token),registerCommands=async e=>{const r=fs_1.default.readdirSync(__dirname+"/../../commands/");for(let e of r){let r=require(`../../commands/${e}`);r.options&&exports.commands.push(r.options)}return await Promise.all(e.guilds.cache.map((async r=>{await rest.put(v9_1.Routes.applicationGuildCommands(e.user.id,r.id),{body:exports.commands}).then((()=>registeredGuilds.push(r.id))).catch((e=>{e.message.toLowerCase().includes("missing")||console.error(e)}))}))),registeredGuilds};exports.registerCommands=registerCommands;