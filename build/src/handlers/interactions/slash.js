"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerCommands=exports.commands=void 0;const constants_1=require("../../constants/"),database_1=__importDefault(require("../../database/")),rest_1=require("@discordjs/rest"),v9_1=require("discord-api-types/v9"),fs_1=__importDefault(require("fs")),config_1=__importDefault(require("../../../config"));exports.commands=[];const registeredGuilds=[],rest=new rest_1.REST({version:"9"}).setToken(config_1.default.token);exports.default=async e=>{if(!e.client.cfg.enslash&&!config_1.default.admins.includes(e.user.id))return await e.reply({content:"❌ Команды были выключены разработчиком. Если вы считаете, что это ошибка, обратитесь к нам: https://discord.gg/AaS4dwVHyA",ephemeral:!0});if((await database_1.default.guild(e.guild.id)).get().channel===e.channel.id)return await e.reply({content:"❌ Команды недоступны в этом канале",ephemeral:!0});const t=e.commandName,r=require(`../../commands/${t}`);if((0,constants_1.getPermissionLevel)(e.member)<r.permission)return await e.reply({content:"❌ Недостаточно прав.",ephemeral:!0});try{await r.run(e)}catch(e){console.error(`Error in ${t}:`,e)}};const registerCommands=async e=>{const t=fs_1.default.readdirSync(__dirname+"/../../commands/");for(let e of t){let t=require(`../../commands/${e}`);t.options&&exports.commands.push(t.options)}return await Promise.all(e.guilds.cache.map((async t=>{await rest.put(v9_1.Routes.applicationGuildCommands(e.user.id,t.id),{body:exports.commands}).then((()=>registeredGuilds.push(t.id))).catch((e=>{e.message.toLowerCase().includes("missing")||console.error(e)}))}))),registeredGuilds};exports.registerCommands=registerCommands;