"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=exports.permission=exports.options=void 0;const builders_1=require("@discordjs/builders");exports.options=(new builders_1.SlashCommandBuilder).setName("ban").setDescription("Забанить участника.").addUserOption((e=>e.setName("member").setDescription("Пользователь, которого надо забанить.").setRequired(!0))).addStringOption((e=>e.setName("duration").setDescription("Время, на которое участник будет забанен."))).addStringOption((e=>e.setName("reason").setDescription("Причина выдачи бана."))).addIntegerOption((e=>e.setName("purgedays").setDescription("Удаление сообщений пользователя за указанное время, в днях.").setMaxValue(7).setMinValue(1))).toJSON(),exports.permission=1;const discord_js_1=require("discord.js"),constants_1=require("../constants/"),resolvers_1=require("../constants/resolvers"),pretty_ms_1=__importDefault(require("pretty-ms")),database_1=__importDefault(require("../database/")),run=async e=>{const t=e.options.getMember("member");if(!e.guild.me.permissions.has("BAN_MEMBERS")||!t.manageable)return await e.reply({content:"❌ Я не могу забанить этого участника.",ephemeral:!0});if(e.options.getString("duration")&&!(0,resolvers_1.parseTime)(e.options.getString("duration")))return await e.reply({content:"❌ Не удалось обработать указанное время.",ephemeral:!0});const s=await e.guild.bans.fetch(),r=await database_1.default.guild(e.guild.id);if(s.has(t.user.id))return await e.reply({content:"❌ Этот пользователь уже забанен.",ephemeral:!0});if((0,constants_1.getPermissionLevel)(t)>=(0,constants_1.getPermissionLevel)(e.member))return await e.reply({content:"❌ Вы не можете забанить этого человека.",ephemeral:!0});await e.deferReply();let i=!1,n=0,a=e.options.getString("reason")?.trim(),o=e.options.getInteger("purgedays");n=e.options.getString("duration")?Date.now()+(0,resolvers_1.parseTime)(e.options.getString("duration")):-1;const d=(new discord_js_1.MessageEmbed).setAuthor({name:e.guild.name,iconURL:e.guild.iconURL({dynamic:!0})}).setTitle("Вы были забанены").addField("Модератор",`${e.user} (**${e.user.tag.replaceAll("*","\\*")}**)`,!0);-1!=n&&d.addField("Время",`\`${(0,pretty_ms_1.default)((0,resolvers_1.parseTime)(e.options.getString("duration")))}\``,!0),a&&d.addField("Причина",a),await t.user.send({embeds:[d]}).then((()=>i=!0)).catch((()=>null)),await e.guild.bans.create(t.id,{reason:`${e.user.tag}: ${a||"Не указана."}`,days:o}).then((async()=>{r.setOnObject("bans",t.user.id,n),await e.editReply({content:`✅ ${t} был успешно забанен.`+(i?"\n[__Пользователь был уведомлён в лс__]":"")})})).catch((async()=>{await e.editReply({content:"❌ Произошла неизвестная ошибка."})}))};exports.run=run;