"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=exports.permission=exports.options=void 0;const builders_1=require("@discordjs/builders");exports.options=(new builders_1.SlashCommandBuilder).setName("mute").setDescription("Замьютить участника.").addUserOption((e=>e.setName("member").setDescription("Участник, которому надо выдать мьют.").setRequired(!0))).addStringOption((e=>e.setName("time").setDescription("Время, на которое участнику надо выдать мьют."))).addStringOption((e=>e.setName("reason").setDescription("Причина выдачи мьюта."))).toJSON(),exports.permission=1;const constants_1=require("../constants/"),resolvers_1=require("../constants/resolvers"),database_1=__importDefault(require("../database/")),run=async e=>{const t=await database_1.default.guild(e.guild.id),r=await database_1.default.settings(e.guild.id),s=e.guild.roles.cache.get(r.get().muteRole),i=e.options.getMember("member");if(!s)return e.reply({content:"❌ Не удалось найти роль мьюта.",ephemeral:!0});if(!e.guild.me.permissions.has("MANAGE_ROLES"))return e.reply({content:"❌ У меня нет прав для изменения ролей.",ephemeral:!0});if(e.guild.me.roles.highest.rawPosition<=s.rawPosition)return e.reply({content:"❌ Роль мьюта находится выше моей.",ephemeral:!0});if(i.user.bot)return e.reply({content:"❌ Вы не можете замьютить бота.",ephemeral:!0});if((0,constants_1.getPermissionLevel)(i)>=1)return e.reply({content:"❌ Вы не можете замьютить этого участника.",ephemeral:!0});if(i.roles.cache.has(s.id))return e.reply({content:"❌ Этот участник уже замьючен.",ephemeral:!0});if(e.options.getString("time")&&!(0,resolvers_1.parseTime)(e.options.getString("time")))return e.reply({content:"❌ Не удалось обработать указанное время.",ephemeral:!0});let n=0;n=e.options.getString("time")?Date.now()+(0,resolvers_1.parseTime)(e.options.getString("time")):-1,await i.roles.add(s).then((async()=>{t.setOnObject("mutes",i.user.id,n),await e.reply({content:`✅ ${i.user} был успешно замьючен.`})})).catch((async t=>{console.error(t),await e.reply({content:"❌ Произошла ошибка.",ephemeral:!0})}))};exports.run=run;