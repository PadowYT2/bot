"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const fastify_1=__importDefault(require("fastify")),config_1=__importDefault(require("../../config")),fastify_session_1=__importDefault(require("fastify-session")),fastify_cookie_1=__importDefault(require("fastify-cookie")),point_of_view_1=__importDefault(require("point-of-view")),ejs_1=__importDefault(require("ejs"));module.exports=()=>{const e=(0,fastify_1.default)();e.register(fastify_cookie_1.default),e.register(fastify_session_1.default,{secret:config_1.default.secretsomething,cookie:{secure:!1,sameSite:!1,maxAge:72e5}}),e.register(point_of_view_1.default,{engine:{ejs:ejs_1.default},root:__dirname+"/views/"}),e.addHook("preHandler",((e,i,t)=>{e.session.lastPage=e.session.lastPage||"/",t()})),e.register(require("./routes/api"),{prefix:"/api"}),e.register(require("./routes/util"),{prefix:"/util"}),e.register(require("./routes/dash"),{prefix:"/dash"}),e.register(require("./routes/root"),{prefix:"/"}),e.listen(config_1.default.port,"0.0.0.0")};