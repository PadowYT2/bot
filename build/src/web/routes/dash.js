"use strict";const discord_js_1=require("discord.js"),sharding_1=require("../../sharding");module.exports=(s,i,e)=>{s.get("/",((s,i)=>i.redirect("/dash/guilds"))),s.get("/guild/:id",(async(s,i)=>{const e=s.params.id,r=s.session.user;if(!e||!r||!(new discord_js_1.Permissions).add(r.guilds.find((s=>s.id===e))?.permissions||"0").has("ADMINISTRATOR"))return i.redirect("/dash/guilds");const d=await sharding_1.manager.broadcastEval(((s,{id:i})=>{const{inspect:e}=require("util"),r=s.guilds.cache.get(i);return r?e(r):null}),{shard:discord_js_1.ShardClientUtil.shardIdForGuildId(e,sharding_1.manager.shards.size),context:{id:e}});if(!d)return i.redirect(`/api/invite/${e}`);i.send(d)})),s.get("/guilds",(async(s,i)=>{if(s.session.lastPage="/dash/guilds",!s.session.user)return i.redirect("/api/login");i.view("dash/guilds.ejs",{user:s.session.user})})),e()};